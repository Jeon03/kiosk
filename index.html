<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë™ì–‘ë¯¸ë˜ëŒ€í•™êµ ìˆ˜ê°•ì‹ ì²­ AI ë„ìš°ë¯¸</title>
    
    <!-- Tailwind CSS (ìŠ¤íƒ€ì¼ë§) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons (ì•„ì´ì½˜) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- í°íŠ¸ ì„¤ì • -->
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; }
        
        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° (ê¹”ë”í•œ UIìš©) */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 flex justify-center items-center min-h-screen p-4">

    <!-- í‚¤ì˜¤ìŠ¤í¬ í”„ë ˆì„ -->
    <div class="w-full max-w-md bg-white h-[850px] rounded-[2rem] shadow-2xl overflow-hidden flex flex-col relative border-8 border-gray-800">
        
        <!-- ìƒë‹¨ í—¤ë” -->
        <div class="bg-blue-600 p-6 pt-10 text-white flex justify-between items-center shadow-md z-10">
            <div>
                <h1 class="text-xl font-bold flex items-center gap-2">
                    <i data-lucide="school"></i> DMU ìˆ˜ê°•ì‹ ì²­ AI
                </h1>
                <p class="text-sm opacity-80 mt-1">ìŠ¤ë§ˆíŠ¸í•œ ì‹œê°„í‘œ ì„¤ê³„ë¥¼ ë„ì™€ë“œë ¤ìš”</p>
            </div>
            <div class="bg-blue-500 p-2 rounded-full">
                <i data-lucide="message-square" width="20"></i>
            </div>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
        <div id="content-area" class="flex-1 overflow-y-auto bg-gray-50 p-6 scrollbar-hide relative">
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ë Œë”ë§ ë©ë‹ˆë‹¤ -->
        </div>

        <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div id="footer-area" class="bg-white p-4 border-t border-gray-100 absolute bottom-0 w-full">
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë²„íŠ¼ì´ ë™ì ìœ¼ë¡œ ë Œë”ë§ ë©ë‹ˆë‹¤ -->
        </div>

    </div>

    <script>
        // --- [ë°ì´í„°] ë™ì–‘ë¯¸ë˜ëŒ€í•™êµ í•™ë¶€/í•™ê³¼ êµ¬ì¡° ---
        const DEPT_STRUCTURE = {
            "ê¸°ê³„ê³µí•™ë¶€": ["ê¸°ê³„ê³µí•™ê³¼", "ê¸°ê³„ì„¤ê³„ê³µí•™ê³¼"],
            "ë¡œë´‡ìë™í™”ê³µí•™ë¶€": ["ìë™í™”ê³µí•™ê³¼", "ë¡œë´‡ì†Œí”„íŠ¸ì›¨ì–´ê³¼"],
            "ì „ê¸°ì „ìí†µì‹ ê³µí•™ë¶€": ["ì „ê¸°ê³µí•™ê³¼", "ë°˜ë„ì²´ì „ìê³µí•™ê³¼", "ì •ë³´í†µì‹ ê³µí•™ê³¼", "ì†Œë°©ì•ˆì „ê´€ë¦¬ê³¼"],
            "ì»´í“¨í„°ê³µí•™ë¶€": ["ì›¹ì‘ìš©ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™ê³¼", "ì»´í“¨í„°ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™ê³¼", "ì¸ê³µì§€ëŠ¥ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼"],
            "ìƒí™œí™˜ê²½ê³µí•™ë¶€": ["ìƒëª…í™”í•™ê³µí•™ê³¼", "ë°”ì´ì˜¤ìœµí•©ê³µí•™ê³¼", "ê±´ì¶•ê³¼", "ì‹¤ë‚´ê±´ì¶•ë””ìì¸ê³¼", "ì‹œê°ë””ìì¸ê³¼", "ARÂ·VRì½˜í…ì¸ ë””ìì¸ê³¼"],
            "ê²½ì˜í•™ë¶€": ["ê²½ì˜í•™ê³¼", "ì„¸ë¬´íšŒê³„í•™ê³¼", "ìœ í†µë§ˆì¼€íŒ…í•™ê³¼", "í˜¸í…”ê´€ê´‘í•™ê³¼", "ê²½ì˜ì •ë³´í•™ê³¼", "ë¹…ë°ì´í„°ê²½ì˜ê³¼"]
        };

        // --- [ë°ì´í„°ë² ì´ìŠ¤] ê°•ì˜ ëª©ë¡ (êµìˆ˜ëª… ì œì™¸ë¨) ---
        const COURSE_DB = [
            { id: 1, code: "CS1001", section: "A", name: "ì›¹í”„ë¡œê·¸ë˜ë°ê¸°ì´ˆ", type: "ì „ê³µ", type_detail: "ì „ê³µì„ íƒ", credit: 3, dept: "ì›¹ì‘ìš©ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™ê³¼", grade: 1, tags: ["ì½”ë”©ê¸°ì´ˆ", "ì‹¤ìŠµìœ„ì£¼", "íŒ€í”Œì—†ìŒ"], desc: "HTML/CSSë¥¼ ë°°ìš°ëŠ” ì…ë¬¸ ìˆ˜ì—…ì…ë‹ˆë‹¤. ì½”ë”©ì„ ì²˜ìŒ ì ‘í•˜ëŠ” í•™ìƒë“¤ì—ê²Œ ì í•©í•©ë‹ˆë‹¤." },
            { id: 2, code: "AI2002", section: "B", name: "ì¸ê³µì§€ëŠ¥ê°œë¡ ", type: "ì „ê³µ", type_detail: "ì „ê³µí•„ìˆ˜", credit: 3, dept: "ì¸ê³µì§€ëŠ¥ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼", grade: 2, tags: ["ì´ë¡ ìœ„ì£¼", "ì‹œí—˜ì–´ë ¤ì›€", "ìµœì‹ ê¸°ìˆ "], desc: "AIì˜ ì—­ì‚¬ì™€ ê¸°ì´ˆ ì´ë¡ (ë¨¸ì‹ ëŸ¬ë‹, ë”¥ëŸ¬ë‹)ì„ ë‹¤ë£¹ë‹ˆë‹¤." },
            { id: 3, code: "CS2004", section: "A", name: "ì°½ì˜ì ê³µí•™ì„¤ê³„", type: "ì „ê³µ", type_detail: "ì „ê³µí•„ìˆ˜", credit: 2, dept: "ì»´í“¨í„°ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™ê³¼", grade: 2, tags: ["íŒ€í”Œí•„ìˆ˜", "ë°œí‘œë§ìŒ", "í•™ì ì˜ì¤Œ"], desc: "íŒ€ì„ ì´ë£¨ì–´ ìº¡ìŠ¤í†¤ ë””ìì¸ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤." },
            { id: 4, code: "CS3001", section: "C", name: "ì„œë²„êµ¬ì¶•ì‹¤ë¬´", type: "ì „ê³µ", type_detail: "ì „ê³µì‹¬í™”", credit: 3, dept: "ì»´í“¨í„°ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™ê³¼", grade: 3, tags: ["ì‹¤ìŠµìœ„ì£¼", "ì·¨ì—…ì—°ê³„", "ì–´ë ¤ì›€"], desc: "Linux í™˜ê²½ì—ì„œ AWS í´ë¼ìš°ë“œ ì„œë²„ë¥¼ êµ¬ì¶•í•˜ëŠ” ì‹¤ìŠµì„ ì§„í–‰í•©ë‹ˆë‹¤." },
            { id: 7, code: "DB2001", section: "A", name: "ë°ì´í„°ë² ì´ìŠ¤", type: "ì „ê³µ", type_detail: "ì „ê³µì„ íƒ", credit: 3, dept: "ì›¹ì‘ìš©ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™ê³¼", grade: 2, tags: ["ì‹œí—˜ì¤‘ìš”", "ì´ë¡ +ì‹¤ìŠµ", "ìê²©ì¦"], desc: "SQL ê¸°ì´ˆ ë¬¸ë²• ë° DB ëª¨ë¸ë§(ERD) ì„¤ê³„ë¥¼ ë°°ì›ë‹ˆë‹¤." },
            
            { id: 10, code: "RB1005", section: "A", name: "ë¡œë´‡ì œì–´ê¸°ì´ˆ", type: "ì „ê³µ", type_detail: "ì „ê³µì„ íƒ", credit: 3, dept: "ë¡œë´‡ì†Œí”„íŠ¸ì›¨ì–´ê³¼", grade: 1, tags: ["ìˆ˜í•™í•„ìš”", "ì‹¤ìŠµë§ìŒ", "ì•„ë‘ì´ë…¸"], desc: "Cì–¸ì–´ë¥¼ í™œìš©í•˜ì—¬ ë¡œë´‡ íŒ”(Manipulator) ì œì–´ì˜ ê¸°ì´ˆë¥¼ ë°°ì›ë‹ˆë‹¤." },
            { id: 11, code: "AT2003", section: "B", name: "ìë™í™”ì‹œìŠ¤í…œ", type: "ì „ê³µ", type_detail: "ì „ê³µí•„ìˆ˜", credit: 3, dept: "ìë™í™”ê³µí•™ê³¼", grade: 2, tags: ["ì¥ë¹„ì‹¤ìŠµ", "íŒ€í”ŒìˆìŒ", "PLC"], desc: "PLC í”„ë¡œê·¸ë˜ë° ë° ìŠ¤ë§ˆíŠ¸ ê³µì¥ ìë™í™” ì‹œìŠ¤í…œì„ ë‹¤ë£¹ë‹ˆë‹¤." },
            { id: 12, code: "ME1002", section: "A", name: "ê¸°ê³„ê³µì‘ë²•", type: "ì „ê³µ", type_detail: "ì „ê³µê¸°ì´ˆ", credit: 2, dept: "ê¸°ê³„ê³µí•™ê³¼", grade: 1, tags: ["ì•ˆì „ì¤‘ìš”", "ì‹¤ê¸°í‰ê°€", "ì„ ë°˜/ë°€ë§"], desc: "ê¸°ê³„ ê°€ê³µì˜ ê¸°ì´ˆ ì›ë¦¬ë¥¼ ë°°ìš°ê³  ì§ì ‘ ë¶€í’ˆì„ ê°€ê³µí•©ë‹ˆë‹¤." },

            { id: 20, code: "MK1001", section: "A", name: "ë§ˆì¼€íŒ…ì›ë¡ ", type: "ì „ê³µ", type_detail: "ì „ê³µì„ íƒ", credit: 3, dept: "ìœ í†µë§ˆì¼€íŒ…í•™ê³¼", grade: 1, tags: ["ë°œí‘œë§ìŒ", "ì¬ë°ŒìŒ", "ì‚¬ë¡€ë¶„ì„"], desc: "ë§ˆì¼€íŒ…ì˜ ê¸°ë³¸ ê°œë…ê³¼ ìµœì‹  íŠ¸ë Œë“œ ì „ëµì„ í•™ìŠµí•©ë‹ˆë‹¤." },
            { id: 21, code: "AC1002", section: "B", name: "íšŒê³„ê¸°ì´ˆ", type: "ì „ê³µ", type_detail: "ì „ê³µí•„ìˆ˜", credit: 3, dept: "ì„¸ë¬´íšŒê³„í•™ê³¼", grade: 1, tags: ["ìˆ«ìì¤‘ìš”", "ìê²©ì¦ì—°ê³„", "ê¼¼ê¼¼í•¨"], desc: "íšŒê³„ì˜ ê¸°ì´ˆ ì›ë¦¬ì™€ ì¬ë¬´ì œí‘œ ì‘ì„±ë²•ì„ ë°°ì›ë‹ˆë‹¤." },

            { id: 5, code: "GE0001", section: "Online", name: "ì˜í™”ë¡œ ë³´ëŠ” ì² í•™", type: "êµì–‘", type_detail: "êµì–‘ì„ íƒ", credit: 2, dept: "êµì–‘", grade: 0, tags: ["ì‹œí—˜ì—†ìŒ", "ê³¼ì œëŒ€ì²´", "ê¿€ê°•"], desc: "ì˜í™”ë¥¼ ê°ìƒí•˜ê³  ì² í•™ì  ì£¼ì œì— ëŒ€í•´ ê°ìƒë¬¸ì„ ì œì¶œí•©ë‹ˆë‹¤." },
            { id: 6, code: "GE0005", section: "A", name: "ê¸€ì“°ê¸°ì™€ í† ë¡ ", type: "êµì–‘", type_detail: "êµì–‘í•„ìˆ˜", credit: 2, dept: "êµì–‘", grade: 0, tags: ["ë°œí‘œë§ìŒ", "íŒ€í”ŒìˆìŒ", "ì˜ì‚¬ì†Œí†µ"], desc: "ë…¼ë¦¬ì ì¸ ê¸€ì“°ê¸° ëŠ¥ë ¥ê³¼ í† ë¡  ë§¤ë„ˆë¥¼ ë°°ì›ë‹ˆë‹¤." },
            { id: 8, code: "GE0012", section: "C", name: "ìƒí™œ ì†ì˜ ë²•ë¥ ", type: "êµì–‘", type_detail: "êµì–‘ì„ íƒ", credit: 2, dept: "êµì–‘", grade: 0, tags: ["ì•”ê¸°ìœ„ì£¼", "ìœ ìš©í•¨", "ì‹œí—˜ì‰¬ì›€"], desc: "ì‹¤ìƒí™œì— ê¼­ í•„ìš”í•œ ë²•ë¥  ìƒì‹ê³¼ ê³„ì•½ì„œ ì‘ì„±ë²•ì„ ë°°ì›ë‹ˆë‹¤." }
        ];

        // --- ìƒíƒœ ê´€ë¦¬ (Global State) ---
        let state = {
            step: 0, // 0:ì„ íƒ, 1:ì§ˆë¬¸, 2:ë¡œë”©, 3:ê²°ê³¼
            selection: { faculty: '', dept: '', grade: '', type: '' },
            query: '',
            results: [],
            aiComment: ''
        };

        // --- UI ë Œë”ë§ í•¨ìˆ˜ ---
        function render() {
            const contentArea = document.getElementById('content-area');
            const footerArea = document.getElementById('footer-area');
            
            contentArea.innerHTML = '';
            footerArea.innerHTML = '';

            // STEP 0: ê¸°ë³¸ ì •ë³´ ì„ íƒ
            if (state.step === 0) {
                renderStep0(contentArea);
                renderFooterStep0(footerArea);
            }
            // STEP 1: ì§ˆë¬¸ ì…ë ¥
            else if (state.step === 1) {
                renderStep1(contentArea);
                renderFooterStep1(footerArea);
            }
            // STEP 2: ë¡œë”©
            else if (state.step === 2) {
                renderStep2(contentArea);
            }
            // STEP 3: ê²°ê³¼
            else if (state.step === 3) {
                renderStep3(contentArea);
                renderFooterStep3(footerArea);
            }

            // ì•„ì´ì½˜ ë¦¬ë¡œë“œ
            lucide.createIcons();
        }

        // --- Step ë³„ ë Œë”ë§ ë¡œì§ ---

        function renderStep0(container) {
            // í—¤ë” í…ìŠ¤íŠ¸
            const header = document.createElement('div');
            header.className = "text-center space-y-2 mb-8 animate-fade-in";
            header.innerHTML = `
                <span class="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded-full">STEP 1</span>
                <h2 class="text-2xl font-bold text-gray-800">ì†Œì† í•™ê³¼ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”</h2>
                <p class="text-gray-500 text-sm">ì •í™•í•œ ì¶”ì²œì„ ìœ„í•´ ì •ë³´ê°€ í•„ìš”í•´ìš”.</p>
            `;
            container.appendChild(header);

            // 1. í•™ë¶€/í•™ê³¼ ì„ íƒ
            const section1 = document.createElement('div');
            section1.className = "space-y-3 mb-6 animate-fade-in";
            section1.innerHTML = `<label class="text-sm font-bold text-gray-600 flex items-center gap-2"><i data-lucide="graduation-cap" width="16"></i> ì†Œì† ì„ íƒ</label>`;
            
            if (!state.selection.faculty) {
                // í•™ë¶€ ì„ íƒ ê·¸ë¦¬ë“œ
                const facultyGrid = document.createElement('div');
                facultyGrid.className = "grid grid-cols-2 gap-2";
                Object.keys(DEPT_STRUCTURE).forEach(fac => {
                    const btn = document.createElement('button');
                    btn.className = "p-4 rounded-xl border text-sm font-bold bg-white text-gray-700 border-gray-200 hover:bg-blue-50 hover:border-blue-300 hover:text-blue-700 transition-all flex flex-col items-center gap-2 text-center h-24 justify-center shadow-sm";
                    btn.innerHTML = `<i data-lucide="building-2" class="opacity-50"></i>${fac}`;
                    btn.onclick = () => setState('selection', { ...state.selection, faculty: fac, dept: '' });
                    facultyGrid.appendChild(btn);
                });
                section1.appendChild(facultyGrid);
            } else {
                // í•™ë¶€ ì„ íƒë¨ -> í•™ê³¼ ë¦¬ìŠ¤íŠ¸
                const selectedHeader = document.createElement('div');
                selectedHeader.className = "flex justify-between items-center bg-blue-50 p-3 rounded-lg border border-blue-100 mb-2";
                selectedHeader.innerHTML = `
                    <span class="text-blue-800 font-bold text-sm flex items-center gap-2"><i data-lucide="building-2" width="16"></i> ${state.selection.faculty}</span>
                `;
                const backBtn = document.createElement('button');
                backBtn.className = "text-xs bg-white border border-gray-200 px-2 py-1 rounded text-gray-500 hover:text-red-500 flex items-center gap-1";
                backBtn.innerHTML = `<i data-lucide="chevron-left" width="12"></i> ë‹¤ì‹œ ì„ íƒ`;
                backBtn.onclick = () => setState('selection', { ...state.selection, faculty: '' });
                selectedHeader.appendChild(backBtn);
                section1.appendChild(selectedHeader);

                const deptList = document.createElement('div');
                deptList.className = "grid grid-cols-1 gap-2";
                DEPT_STRUCTURE[state.selection.faculty].forEach(dept => {
                    const btn = document.createElement('button');
                    const isSelected = state.selection.dept === dept;
                    btn.className = `p-3 rounded-xl border text-left px-4 font-medium transition-all flex justify-between items-center ${isSelected ? 'bg-blue-600 text-white border-blue-600 shadow-md ring-2 ring-blue-200' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                    btn.innerHTML = `${dept} ${isSelected ? '<i data-lucide="check-circle" width="16"></i>' : ''}`;
                    btn.onclick = () => setState('selection', { ...state.selection, dept: dept });
                    deptList.appendChild(btn);
                });
                section1.appendChild(deptList);
            }
            container.appendChild(section1);

            // 2. í•™ë…„ ì„ íƒ
            const section2 = document.createElement('div');
            const isDeptSelected = !!state.selection.dept;
            section2.className = `space-y-3 mb-6 transition-opacity duration-300 ${!isDeptSelected ? 'opacity-40 pointer-events-none' : 'opacity-100'}`;
            section2.innerHTML = `<label class="text-sm font-bold text-gray-600 flex items-center gap-2"><i data-lucide="star" width="16"></i> í•™ë…„</label>`;
            const gradeGroup = document.createElement('div');
            gradeGroup.className = "flex gap-2";
            ['1', '2', '3', '4'].forEach(g => {
                const btn = document.createElement('button');
                const isSelected = state.selection.grade === g;
                btn.className = `flex-1 p-3 rounded-xl border text-sm font-medium transition-all ${isSelected ? 'bg-blue-600 text-white border-blue-600 shadow-md' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                btn.textContent = `${g}í•™ë…„`;
                btn.onclick = () => setState('selection', { ...state.selection, grade: g });
                gradeGroup.appendChild(btn);
            });
            section2.appendChild(gradeGroup);
            container.appendChild(section2);

            // 3. ì´ìˆ˜ êµ¬ë¶„ ì„ íƒ
            const section3 = document.createElement('div');
            const isGradeSelected = !!state.selection.grade;
            section3.className = `space-y-3 pb-20 transition-opacity duration-300 ${!isGradeSelected ? 'opacity-40 pointer-events-none' : 'opacity-100'}`;
            section3.innerHTML = `<label class="text-sm font-bold text-gray-600 flex items-center gap-2"><i data-lucide="book-open" width="16"></i> ì´ìˆ˜ êµ¬ë¶„</label>`;
            const typeGroup = document.createElement('div');
            typeGroup.className = "flex gap-2";
            ['ì „ê³µ', 'êµì–‘'].forEach(t => {
                const btn = document.createElement('button');
                const isSelected = state.selection.type === t;
                btn.className = `flex-1 p-4 rounded-xl border text-lg font-bold transition-all ${isSelected ? 'bg-indigo-600 text-white border-indigo-600 shadow-lg transform scale-105' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                btn.textContent = t;
                btn.onclick = () => setState('selection', { ...state.selection, type: t });
                typeGroup.appendChild(btn);
            });
            section3.appendChild(typeGroup);
            container.appendChild(section3);
        }

        function renderFooterStep0(container) {
            const isValid = state.selection.dept && state.selection.grade && state.selection.type;
            const btn = document.createElement('button');
            btn.className = `w-full py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition-all ${isValid ? 'bg-blue-600 text-white shadow-lg hover:bg-blue-700' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`;
            btn.innerHTML = `ë‹¤ìŒ ë‹¨ê³„ë¡œ <i data-lucide="chevron-right"></i>`;
            btn.disabled = !isValid;
            btn.onclick = () => { if(isValid) setState('step', 1); };
            container.appendChild(btn);
        }

        function renderStep1(container) {
            container.innerHTML = `
                <div class="space-y-6 animate-fade-in h-full flex flex-col">
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-xs text-gray-400 mb-1">í˜„ì¬ ì„ íƒëœ ì •ë³´</p>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-md font-bold">${state.selection.dept}</span>
                            <span class="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-md font-bold">${state.selection.grade}í•™ë…„</span>
                            <span class="px-2 py-1 bg-indigo-50 text-indigo-700 text-xs rounded-md font-bold">${state.selection.type}</span>
                        </div>
                    </div>

                    <div class="text-center mt-4">
                        <span class="bg-indigo-100 text-indigo-800 text-xs font-bold px-2 py-1 rounded-full">STEP 2</span>
                        <h2 class="text-2xl font-bold text-gray-800 mt-2">ë¬´ì—‡ì´ ê¶ê¸ˆí•œê°€ìš”?</h2>
                        <p class="text-gray-500 text-sm">AIê°€ ê°•ì˜ê³„íšì„œë¥¼ ë¶„ì„í•´ ì¶”ì²œí•´ë“œë ¤ìš”.</p>
                    </div>

                    <div class="flex-1 flex flex-col justify-center gap-4">
                        <div class="relative">
                            <textarea id="queryInput"
                                class="w-full h-32 p-4 rounded-2xl border-2 border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 resize-none text-lg transition-all"
                                placeholder="ê¶ê¸ˆí•œ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.">${state.query}</textarea>
                            <div class="absolute bottom-3 right-3 bg-gray-100 p-2 rounded-full text-gray-500">
                                <i data-lucide="mic" width="20"></i>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            // ì´ë²¤íŠ¸ ë°”ì¸ë”©
            container.querySelector('#queryInput').addEventListener('input', (e) => {
                state.query = e.target.value;
                // input ì´ë²¤íŠ¸ì—ì„œëŠ” ì „ì²´ ë¦¬ë Œë”ë§ í•˜ì§€ ì•Šê³  ë²„íŠ¼ ìƒíƒœë§Œ ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•´ ë³„ë„ ì²˜ë¦¬ ê°€ëŠ¥í•˜ë‚˜, 
                // ì—¬ê¸°ì„  ê°„ë‹¨í•˜ê²Œ DOM ìœ ì§€í•˜ë©° ìƒíƒœë§Œ ì—…ë°ì´íŠ¸, ë²„íŠ¼ ë¦¬ë Œë”ë§ì€ footerì—ì„œ ì²˜ë¦¬í•´ì•¼ í•¨.
                // í¸ì˜ìƒ render() í˜¸ì¶œ ì•ˆí•˜ê³  footer ë²„íŠ¼ë§Œ ê°±ì‹ 
                const footerBtn = document.getElementById('searchBtn');
                if(state.query) {
                    footerBtn.disabled = false;
                    footerBtn.className = "flex-[2] py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition-all bg-indigo-600 text-white shadow-lg hover:bg-indigo-700";
                } else {
                    footerBtn.disabled = true;
                    footerBtn.className = "flex-[2] py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition-all bg-gray-200 text-gray-400";
                }
            });
        }

        function renderFooterStep1(container) {
            const wrapper = document.createElement('div');
            wrapper.className = "flex gap-2";
            
            const prevBtn = document.createElement('button');
            prevBtn.className = "flex-1 py-4 bg-gray-100 text-gray-600 rounded-xl font-bold hover:bg-gray-200";
            prevBtn.innerText = "ì´ì „";
            prevBtn.onclick = () => setState('step', 0);
            
            const searchBtn = document.createElement('button');
            searchBtn.id = "searchBtn";
            const hasQuery = !!state.query;
            searchBtn.className = `flex-[2] py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition-all ${hasQuery ? 'bg-indigo-600 text-white shadow-lg hover:bg-indigo-700' : 'bg-gray-200 text-gray-400'}`;
            searchBtn.innerHTML = `AIì—ê²Œ ë¬¼ì–´ë³´ê¸° <i data-lucide="search" width="20"></i>`;
            searchBtn.disabled = !hasQuery;
            searchBtn.onclick = handleSearch;

            wrapper.appendChild(prevBtn);
            wrapper.appendChild(searchBtn);
            container.appendChild(wrapper);
        }

        function renderStep2(container) {
            container.innerHTML = `
                <div class="h-full flex flex-col justify-center items-center space-y-6 animate-pulse">
                    <div class="w-20 h-20 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
                    <div class="text-center space-y-2">
                        <h3 class="text-xl font-bold text-gray-800">AI ë¶„ì„ ì¤‘...</h3>
                        <p class="text-gray-500">ê°•ì˜ê³„íšì„œ 320ê°œë¥¼ ì½ê³  ìˆì–´ìš”.</p>
                        <p class="text-sm text-blue-600 font-medium mt-2">"${state.query}"</p>
                    </div>
                </div>
            `;
        }

        function renderStep3(container) {
            const wrapper = document.createElement('div');
            wrapper.className = "space-y-6 animate-fade-in pb-20";

            // AI ì½”ë©˜íŠ¸
            wrapper.innerHTML += `
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                    <div class="flex items-start gap-3">
                        <div class="bg-blue-600 p-2 rounded-full text-white mt-1">
                            <i data-lucide="message-square" width="16"></i>
                        </div>
                        <div>
                            <p class="font-bold text-blue-900 text-sm mb-1">AI ì¶”ì²œ ì½”ë©˜íŠ¸</p>
                            <p class="text-gray-700 text-sm leading-relaxed">${state.aiComment}</p>
                        </div>
                    </div>
                </div>
            `;

            // ê²°ê³¼ ë¦¬ìŠ¤íŠ¸
            const listContainer = document.createElement('div');
            listContainer.className = "space-y-4";
            
            if (state.results.length > 0) {
                state.results.forEach((course, idx) => {
                    const card = document.createElement('div');
                    card.className = "bg-white p-5 rounded-2xl shadow-md border border-gray-100 hover:border-blue-300 transition-all cursor-pointer group";
                    card.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <div class="flex gap-2">
                                <span class="bg-gray-100 text-gray-600 text-xs font-bold px-2 py-1 rounded">${course.type_detail}</span>
                                <span class="bg-indigo-50 text-indigo-600 text-xs font-bold px-2 py-1 rounded">${course.credit}í•™ì </span>
                            </div>
                            ${idx === 0 ? '<span class="bg-red-100 text-red-600 text-xs font-bold px-2 py-1 rounded flex items-center gap-1">ğŸ¥‡ 1ìˆœìœ„</span>' : ''}
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-1 group-hover:text-blue-600 flex items-center gap-2">
                            ${course.name} <span class="text-xs text-gray-400 font-normal">(${course.code})</span>
                        </h3>
                        <div class="flex items-center gap-3 text-sm text-gray-500 mb-3">
                            <span class="flex items-center gap-1"><i data-lucide="clock" width="14"></i> ${course.section}ë°˜</span>
                        </div>
                        <p class="text-gray-600 text-sm mb-4 line-clamp-2 bg-gray-50 p-3 rounded-lg border border-gray-100">${course.desc}</p>
                        <div class="flex flex-wrap gap-2">
                            ${course.tags.map(tag => `<span class="text-xs px-2 py-1 bg-blue-50 text-blue-600 rounded-md font-medium">#${tag}</span>`).join('')}
                        </div>
                    `;
                    listContainer.appendChild(card);
                });
            } else {
                listContainer.innerHTML = `
                    <div class="text-center py-10 text-gray-400">
                        <p>ì¡°ê±´ì— ë§ëŠ” ê³¼ëª©ì„ ì°¾ì§€ ëª»í–ˆì–´ìš” ğŸ˜¢</p>
                        <p class="text-xs mt-2">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë‚˜ ì¡°ê±´ì„ ì‹œë„í•´ë³´ì„¸ìš”.</p>
                    </div>
                `;
            }
            wrapper.appendChild(listContainer);
            container.appendChild(wrapper);
        }

        function renderFooterStep3(container) {
            const btn = document.createElement('button');
            btn.className = "w-full py-4 bg-gray-800 text-white rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg hover:bg-gray-900";
            btn.innerHTML = `<i data-lucide="refresh-ccw" width="20"></i> ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°`;
            btn.onclick = resetAll;
            container.appendChild(btn);
        }


        // --- ë¡œì§ í•¨ìˆ˜ë“¤ ---

        function setState(key, value) {
            if (key === 'selection') {
                state.selection = value;
            } else if (key === 'step') {
                state.step = value;
            } else if (key === 'query') {
                state.query = value;
            } else if (key === 'reset') {
                state = {
                    step: 0,
                    selection: { faculty: '', dept: '', grade: '', type: '' },
                    query: '',
                    results: [],
                    aiComment: ''
                };
            }
            render();
        }

        function handleSearch() {
            if (!state.query) return;
            state.step = 2; // Loading
            render();

            // ê°€ìƒì˜ API í˜¸ì¶œ ì§€ì—°
            setTimeout(() => {
                // 1. í•„í„°ë§
                let filtered = COURSE_DB.filter(c => {
                    const strictDeptMatch = state.selection.type === 'êµì–‘' ? c.type === 'êµì–‘' : c.dept === state.selection.dept;
                    const gradeMatch = state.selection.type === 'êµì–‘' ? true : c.grade === parseInt(state.selection.grade);
                    const typeMatch = c.type === state.selection.type;
                    return strictDeptMatch && gradeMatch && typeMatch;
                });

                // Fallback (ì „ê³µì¸ë° ê²°ê³¼ ì—†ìœ¼ë©´ í•™ë¶€ ë²”ìœ„ ë“± í¬í•¨ - ì—¬ê¸°ì„  ë‹¨ìˆœí™”)
                if (filtered.length === 0 && state.selection.type === 'ì „ê³µ') {
                    filtered = COURSE_DB.filter(c => (c.dept === state.selection.dept || state.selection.faculty.includes("í•™ë¶€")) && c.type === 'ì „ê³µ');
                }

                // 2. ê²€ìƒ‰ì–´ ìŠ¤ì½”ì–´ë§
                const queryLower = state.query.toLowerCase();
                filtered = filtered.map(course => {
                    let score = 0;
                    if (queryLower.includes("íŒ€í”Œ") && course.tags.includes("íŒ€í”Œì—†ìŒ")) score += 10;
                    if (queryLower.includes("íŒ€í”Œ") && course.tags.includes("íŒ€í”Œí•„ìˆ˜")) score -= 10;
                    if (queryLower.includes("ì‹œí—˜") && course.tags.includes("ì‹œí—˜ì—†ìŒ")) score += 5;
                    if (queryLower.includes("ê¿€") && course.tags.includes("ê¿€ê°•")) score += 10;
                    if (queryLower.includes("ì½”ë”©") && course.tags.includes("ì½”ë”©ê¸°ì´ˆ")) score += 5;
                    if (course.name.includes(state.query) || course.desc.includes(state.query)) score += 3;
                    score += 1;
                    return { ...course, score };
                }).sort((a, b) => b.score - a.score);

                state.results = filtered.slice(0, 3);
                state.aiComment = `ì„ íƒí•˜ì‹  [${state.selection.dept} ${state.selection.grade}í•™ë…„ / ${state.selection.type}] ì¡°ê±´ì—ì„œ "${state.query}"ì— ê°€ì¥ ì í•©í•œ ê°•ì˜ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`;
                state.step = 3;
                render();
            }, 1500);
        }

        function resetAll() {
            setState('reset');
        }

        // ì´ˆê¸° ì‹¤í–‰
        render();

    </script>
</body>
</html>